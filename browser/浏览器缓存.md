### 浏览器缓存

浏览器缓存，主要针对的是前端的静态资源。

浏览器对服务器资源发起请求之后，拉取相应的静态资源，并保存在本地。如果服务器资源没有更新，那么下次再次请求该资源的时候，就直接从本地读取缓存资源，如果服务器静态资源已经更新，那么我们再次从服务器拉取最新的资源，并缓存在本地，这样大大减少了服务器请求的次数，提高了网站的性能。这就是浏览器的缓存策略，主要实现分为**强缓存**与**协商缓存**。

#### 强缓存 Expires/Cache-Control

强缓存利用**Expires**或者**Cache-Control**这两个**Http Header**来实现，用来表示资源在客户端的有效期。这两个header可以同时存在，**Cache-Control**的优先级高于**Expires**。

1. 浏览器第一次请求服务器资源时，服务器返回这个资源的同时，会在**Response Headers**加上**Expires**或者**Cache-Control**
2. 浏览器接收到资源后，会把资源连同所有**Response Headers**一起缓存下来
3. 再次访问该资源，先从缓存中寻找，找到该资源后，再拿这个过期时间与当前时间进行比较，如果在过期时间内，则命中缓存

**Cache-Control**常见值：

- max-age=：指定资源在缓存中的最大有效时间，单位为秒。例如，`Cache-Control: max-age=3600` 表示资源在缓存中有效一小时。
- no-cache：**表示每次请求都要与服务器进行验证，不能直接使用缓存**。
- no-store：表示不缓存任何请求或响应的内容。
- public：表示响应可以被任何缓存（包括客户端和中间代理服务器）缓存。
- private：表示响应只能被客户端，中间代理服务器不应该缓存响应。



当强缓存没有命中的时候，浏览器开始尝试使用协商缓存策略。

#### 协商缓存 ETag/Last-Modified

协商缓存利用**ETag**和**Last-Modified**这两个**Http Header**来实现。

**ETag**是一个由服务器生成的用于标识资源的唯一标识符。

**Last-Modified**表示资源最后修改的时间。

1. 浏览器第一次请求服务器资源时，服务器返回这个资源的同时，会在**Response Headers**加上**Etag**和**Last-modified**来确定这个资源的唯一标识与最后修改时间
2. 浏览器接收到资源后，会把资源连同所有**Response Headers**一起缓存下来
3. 再次访问该资源，会在浏览器**Request Headers**中通过**If-None-Match**携带**ETag**的值，**If-Modified-Since**携带**Last-modified**的值，如果服务器发现资源的**ETag**值匹配并且资源没有发现变化，服务器会返回**304 Not Modified**状态码，那么就命中了协商缓存，可以直接从缓存中获取资源，无需重新下载资源，如果没有命中则重新下载资源



![2024-06-06-1052](https://github.com/cd0287912/docs/blob/master/screenShoot/2024-06-06-1052.svg?raw=true)